(this["webpackJsonpvirtual-background-demo"]=this["webpackJsonpvirtual-background-demo"]||[]).push([[0],{174:function(e,t,o){e.exports=o(303)},303:function(e,t,o){"use strict";o.r(t);var n=o(0),a=o.n(n),r=o(25),i=o.n(r),l=o(35),c=o(71),s=o(160),u=o(21),f=o.n(u),d=f.a.mark(m);function m(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),d)}var g,h,p={counter:0},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=(arguments.length>1&&arguments[1],Object.assign({},e));return t.counter++,t},v=o(311),V=Object(v.a)({INITIALIZE:function(e){return e}}),w=o(72),R=o(143),b=o(144),C=o(164),k=o(162),y=o(17),I=o(313),S=o(163),x=o(100);!function(e){e[e.Full=0]="Full",e[e.Large=1]="Large",e[e.Small=2]="Small"}(g||(g={})),function(e){e[e.BottomLeft=0]="BottomLeft",e[e.BottomRight=1]="BottomRight"}(h||(h={}));var L=function(e){Object(C.a)(o,e);var t=Object(k.a)(o);function o(){var e;Object(R.a)(this,o);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={foregroundSizeChange:!1,foregroundSize:g.Full,foregroundPosition:h.BottomRight,selectedDeviceID:"",selectedResolution:720},e.localCanvasRef=n.createRef(),e.localVideoRef=n.createRef(),e.localVideoEffectors=null,e.fileInputRef=n.createRef(),e.shareVideoElementRef=n.createRef(),e.monitorCanvasRef=n.createRef(),e.isIPhone=!1,e.imageCapture=void 0,e.virtualBGImage=document.createElement("img"),e.dropdownVideoInput=null,e.dropdownVideoResolution=null,e.enter=0,e.exit=0,e.drawVideoCanvas=Object(w.a)(f.a.mark((function t(){var o,n,a,r,i;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.enter=performance.now(),o=e.enter-e.exit,o.toFixed(3),n=performance.now(),null!==e.localCanvasRef.current&&(a=e.state.selectedResolution,r=a/e.localCanvasRef.current.width*e.localCanvasRef.current.height,e.localVideoEffectors.doEffect(a,r),0!==e.localVideoEffectors.outputWidth&&0!==e.localVideoEffectors.outputHeight&&(e.localCanvasRef.current.height=e.localCanvasRef.current.width/e.localVideoEffectors.outputWidth*e.localVideoEffectors.outputHeight,e.localCanvasRef.current.getContext("2d").drawImage(e.localVideoEffectors.outputCanvas,0,0,e.localCanvasRef.current.width,e.localCanvasRef.current.height))),i=performance.now(),(i-n).toFixed(3),e.exit=performance.now(),requestAnimationFrame((function(){return e.drawVideoCanvas()}));case 10:case"end":return t.stop()}}),t)}))),e.unsetBGImage=function(){e.localVideoEffectors.virtualBackgroundEnabled=!1},e.setBGImage=function(){e.localVideoEffectors.virtualBackgroundEnabled=!0,e.localVideoEffectors.virtualBackgroundImageElement=e.virtualBGImage,e.setState({foregroundSizeChange:!0}),e.shareVideoElementRef.current.pause()},e.sharedDisplaySelected=Object(w.a)(f.a.mark((function t(){var o;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.localVideoEffectors.virtualBackgroundEnabled=!0,{},t.next=4,navigator.mediaDevices.getDisplayMedia({video:!0});case 4:o=t.sent,e.localVideoEffectors.virtualBackgroundStream=o,e.setState({foregroundSizeChange:!0}),e.shareVideoElementRef.current.pause();case 8:case"end":return t.stop()}}),t)}))),e.sharedVideoSelected=function(t){e.localVideoEffectors.virtualBackgroundEnabled=!0;var o=URL.createObjectURL(t.target.files[0]);console.log(o),e.shareVideoElementRef.current.src=o,e.shareVideoElementRef.current.play(),setTimeout(Object(w.a)(f.a.mark((function t(){var o;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.shareVideoElementRef.current.captureStream();case 2:o=t.sent,e.localVideoEffectors.virtualBackgroundStream=o,e.setState({foregroundSizeChange:!0});case 5:case"end":return t.stop()}}),t)}))),3e3)},e}return Object(b.a)(o,[{key:"componentDidMount",value:function(){var e=this,t=new URL(window.location.href).searchParams.get("model"),o=new URL(window.location.href).searchParams.get("blur"),a=0;this.localVideoEffectors="MobileNetV1"===t?new y.LocalVideoEffectors(y.ModelConfigMobileNetV1):"MobileNetV1_05"===t?new y.LocalVideoEffectors(y.ModelConfigMobileNetV1_05):"ResNet"===t?new y.LocalVideoEffectors(y.ModelConfigResNet):new y.LocalVideoEffectors(null),a=null===o?0:parseInt(o),this.localVideoEffectors.cameraEnabled=!0,this.localVideoEffectors.virtualBackgroundEnabled=!1,this.virtualBGImage.src="./resources/vbg/pic1.jpg",this.localVideoEffectors.virtualBackgroundImageElement=this.virtualBGImage,this.localVideoEffectors.maskBlurAmount=a,this.localVideoEffectors.monitorCanvas=this.monitorCanvasRef.current,this.localVideoEffectors.selectInputVideoDevice("").then((function(){requestAnimationFrame((function(){return e.drawVideoCanvas()}))})),Object(y.getDeviceLists)().then((function(t){console.log("----------------",t);var o=[];t.videoinput.map((function(e){console.log("----------------",e),o.push({key:e.label,text:e.label,value:e.deviceId})})),e.dropdownVideoInput=n.createElement(I.a,{placeholder:"State",search:!0,selection:!0,options:o,onChange:function(t,o){var n;e.setState({selectedDeviceID:o.value}),null===(n=e.localVideoEffectors)||void 0===n||n.selectInputVideoDevice(o.value).then((function(){}))}});var a=[];[360,540,720,1280].map((function(e){a.push({key:e+"p",text:e+"p",value:e})})),e.dropdownVideoResolution=n.createElement(I.a,{placeholder:"State",search:!0,selection:!0,options:a,onChange:function(t,o){e.setState({selectedResolution:o.value})}}),e.setState({})}))}},{key:"render",value:function(){var e,t=this;if(navigator.userAgent.indexOf("iPhone")>=0&&(this.isIPhone=!0),this.isIPhone,this.state.foregroundSize===g.Full)null===(e=this.localVideoEffectors)||void 0===e||e.setForegroundPosition(0,0,1,1);else if(this.state.foregroundSize===g.Large){var o,a;if(this.state.foregroundPosition===h.BottomLeft)null===(o=this.localVideoEffectors)||void 0===o||o.setForegroundPosition(0,.4,.6,.6);else null===(a=this.localVideoEffectors)||void 0===a||a.setForegroundPosition(.4,.4,.6,.6)}else if(this.state.foregroundSize===g.Small){var r,i;if(this.state.foregroundPosition===h.BottomLeft)null===(r=this.localVideoEffectors)||void 0===r||r.setForegroundPosition(0,.7,.3,.3);else null===(i=this.localVideoEffectors)||void 0===i||i.setForegroundPosition(.7,.7,.3,.3)}return n.createElement("div",{style:{width:"1280px",margin:"auto"}},this.isIPhone?n.createElement("video",{ref:this.localVideoRef,style:{display:"block",width:"160px",margin:"auto"},playsInline:!0}):n.createElement("video",{ref:this.shareVideoElementRef,width:"1280px",style:{display:"none",width:"1280px",margin:"auto"},playsInline:!0}),n.createElement("canvas",{ref:this.localCanvasRef,width:"1280px",style:{display:"block",width:"1280px",margin:"auto"}}),n.createElement("div",{style:{paddingLeft:"10px"}},n.createElement(S.a,{as:"a",onClick:function(){t.unsetBGImage()}},n.createElement(x.a,{name:"share square outline",size:"large"}),"NoVBG"),n.createElement(S.a,{as:"a",onClick:function(){t.setBGImage()}},n.createElement(x.a,{name:"image outline",size:"large"}),"Image"),this.isIPhone?n.createElement(S.a,null):n.createElement(S.a,{as:"a",onClick:function(){t.sharedDisplaySelected()}},n.createElement(x.a,{name:"share square outline",size:"large"}),"screen"),n.createElement(S.a,{as:"a",onClick:function(){return t.fileInputRef.current.click()}},n.createElement(x.a,{name:"play",size:"large"}),"movie"),n.createElement("input",{ref:this.fileInputRef,type:"file",hidden:!0,onChange:function(e){return t.sharedVideoSelected(e)}}),n.createElement(S.a,{as:"a",onClick:function(){t.localVideoEffectors.foregroundType=y.ForegroundType.NONE}},n.createElement(x.a,{name:"chess board",size:"large"}),"none"),n.createElement(S.a,{as:"a",onClick:function(){t.localVideoEffectors.foregroundType=y.ForegroundType.Canny}},n.createElement(x.a,{name:"chess board",size:"large"}),"canny"),n.createElement(S.a,{as:"a",onClick:function(){t.localVideoEffectors.foregroundType=y.ForegroundType.Ascii}},n.createElement(x.a,{name:"chess board",size:"large"}),"ascii")),n.createElement("div",{style:{paddingLeft:"10px"}},n.createElement(x.a,{basic:!0,link:!0,name:"long arrow alternate left",size:"large",onClick:function(){t.setState({foregroundPosition:h.BottomLeft})}}),n.createElement(x.a,{basic:!0,link:!0,name:"long arrow alternate right",size:"large",onClick:function(){t.setState({foregroundPosition:h.BottomRight})}}),n.createElement(x.a,{basic:!0,link:!0,name:"square outline",size:"large",onClick:function(){t.setState({foregroundSize:g.Full})}}),n.createElement(x.a,{basic:!0,link:!0,name:"expand",size:"large",onClick:function(){t.setState({foregroundSize:g.Large})}}),n.createElement(x.a,{basic:!0,link:!0,name:"compress",size:"large",onClick:function(){t.setState({foregroundSize:g.Small})}})),this.isIPhone?n.createElement("input",{type:"button",value:"start",onClick:function(e){navigator.mediaDevices.getUserMedia({audio:!1,video:{width:{ideal:1280},height:{ideal:720}}}).then((function(e){if(null!==e)return t.localVideoRef.current.srcObject=e,t.localVideoRef.current.play(),new Promise((function(e,o){t.localVideoRef.current.onloadedmetadata=function(){e()}}))})),t.localVideoEffectors.setVideoElement(t.localVideoRef.current)}}):n.createElement("div",null),n.createElement("div",null,n.createElement("span",{style:{marginLeft:"10px"}},"VideoSource",this.dropdownVideoInput),n.createElement("span",{style:{marginLeft:"30px"}},"VideoResolution",this.dropdownVideoResolution)),n.createElement("div",null,n.createElement("span",{style:{marginLeft:"10px"}},n.createElement("a",{href:"https://www.flect.co.jp/"},"powered by FLECT, CO., LTD.")),n.createElement("span",{style:{marginLeft:"30px"}},n.createElement("a",{href:"https://github.com/FLECT-DEV-TEAM/LocalVideoEffector#readme"},"github"),","),n.createElement("span",{style:{marginLeft:"30px"}},n.createElement("a",{href:"https://www.npmjs.com/package/local-video-effector"},"npm"),",")))}}]),o}(n.Component);var B=Object(c.b)((function(e){return e}),(function(e){return{initialize:function(t){e(V.initialize(t))}}}))(L),z=Object(s.a)(),P=Object(l.d)(E,Object(l.a)(z));z.run(m),i.a.render(a.a.createElement(c.a,{store:P},a.a.createElement(B,null)),document.getElementById("root"))}},[[174,1,2]]]);